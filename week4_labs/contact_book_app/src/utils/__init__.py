import re
import flet as ft

EMAIL_PATTERN = re.compile(r"^[^\s@]+@[^\s@]+\.[^\s@]+$")

country_prefixes = {
    "AFG (+93)": "+93",
    "ALB (+355)": "+355",
    "DZA (+213)": "+213",
    "ASM (+1-684)": "+1-684",
    "AND (+376)": "+376",
    "AGO (+244)": "+244",
    "AIA (+1-264)": "+1-264",
    "ATA (+672)": "+672",
    "ATG (+1-268)": "+1-268",
    "ARG (+54)": "+54",
    "ARM (+374)": "+374",
    "ABW (+297)": "+297",
    "AUS (+61)": "+61",
    "AUT (+43)": "+43",
    "AZE (+994)": "+994",
    "BHS (+1-242)": "+1-242",
    "BHR (+973)": "+973",
    "BGD (+880)": "+880",
    "BRB (+1-246)": "+1-246",
    "BLR (+375)": "+375",
    "BEL (+32)": "+32",
    "BLZ (+501)": "+501",
    "BEN (+229)": "+229",
    "BMU (+1-441)": "+1-441",
    "BTN (+975)": "+975",
    "BOL (+591)": "+591",
    "BIH (+387)": "+387",
    "BWA (+267)": "+267",
    "BRA (+55)": "+55",
    "VGB (+1-284)": "+1-284",
    "BRN (+673)": "+673",
    "BGR (+359)": "+359",
    "BFA (+226)": "+226",
    "BDI (+257)": "+257",
    "KHM (+855)": "+855",
    "CMR (+237)": "+237",
    "CAN (+1)": "+1",
    "CPV (+238)": "+238",
    "CYM (+1-345)": "+1-345",
    "CAF (+236)": "+236",
    "TCD (+235)": "+235",
    "CHL (+56)": "+56",
    "CHN (+86)": "+86",
    "COL (+57)": "+57",
    "COM (+269)": "+269",
    "COK (+682)": "+682",
    "CRI (+506)": "+506",
    "HRV (+385)": "+385",
    "CUB (+53)": "+53",
    "CUW (+599)": "+599",
    "CYP (+357)": "+357",
    "CZE (+420)": "+420",
    "COD (+243)": "+243",
    "DNK (+45)": "+45",
    "DJI (+253)": "+253",
    "DMA (+1-767)": "+1-767",
    "DOM (+1-809)": "+1-809",
    "TLS (+670)": "+670",
    "ECU (+593)": "+593",
    "EGY (+20)": "+20",
    "SLV (+503)": "+503",
    "GNQ (+240)": "+240",
    "ERI (+291)": "+291",
    "EST (+372)": "+372",
    "ETH (+251)": "+251",
    "FLK (+500)": "+500",
    "FRO (+298)": "+298",
    "FJI (+679)": "+679",
    "FIN (+358)": "+358",
    "FRA (+33)": "+33",
    "PYF (+689)": "+689",
    "GAB (+241)": "+241",
    "GMB (+220)": "+220",
    "GEO (+995)": "+995",
    "DEU (+49)": "+49",
    "GHA (+233)": "+233",
    "GIB (+350)": "+350",
    "GRC (+30)": "+30",
    "GRL (+299)": "+299",
    "GRD (+1-473)": "+1-473",
    "GUM (+1-671)": "+1-671",
    "GTM (+502)": "+502",
    "GGY (+44-1481)": "+44-1481",
    "GIN (+224)": "+224",
    "GNB (+245)": "+245",
    "GUY (+592)": "+592",
    "HTI (+509)": "+509",
    "HND (+504)": "+504",
    "HKG (+852)": "+852",
    "HUN (+36)": "+36",
    "ISL (+354)": "+354",
    "IND (+91)": "+91",
    "IDN (+62)": "+62",
    "IRN (+98)": "+98",
    "IRQ (+964)": "+964",
    "IRL (+353)": "+353",
    "IMN (+44-1624)": "+44-1624",
    "ISR (+972)": "+972",
    "ITA (+39)": "+39",
    "CIV (+225)": "+225",
    "JAM (+1-876)": "+1-876",
    "JPN (+81)": "+81",
    "JEY (+44-1534)": "+44-1534",
    "JOR (+962)": "+962",
    "KAZ (+7)": "+7",
    "KEN (+254)": "+254",
    "KIR (+686)": "+686",
    "KOS (+383)": "+383",
    "KWT (+965)": "+965",
    "KGZ (+996)": "+996",
    "LAO (+856)": "+856",
    "LVA (+371)": "+371",
    "LBN (+961)": "+961",
    "LSO (+266)": "+266",
    "LBR (+231)": "+231",
    "LBY (+218)": "+218",
    "LIE (+423)": "+423",
    "LTU (+370)": "+370",
    "LUX (+352)": "+352",
    "MAC (+853)": "+853",
    "MKD (+389)": "+389",
    "MDG (+261)": "+261",
    "MWI (+265)": "+265",
    "MYS (+60)": "+60",
    "MDV (+960)": "+960",
    "MLI (+223)": "+223",
    "MLT (+356)": "+356",
    "MHL (+692)": "+692",
    "MRT (+222)": "+222",
    "MUS (+230)": "+230",
    "MEX (+52)": "+52",
    "FSM (+691)": "+691",
    "MDA (+373)": "+373",
    "MCO (+377)": "+377",
    "MNG (+976)": "+976",
    "MNE (+382)": "+382",
    "MSR (+1-664)": "+1-664",
    "MAR (+212)": "+212",
    "MOZ (+258)": "+258",
    "MMR (+95)": "+95",
    "NAM (+264)": "+264",
    "NRU (+674)": "+674",
    "NPL (+977)": "+977",
    "NLD (+31)": "+31",
    "NZL (+64)": "+64",
    "NIC (+505)": "+505",
    "NER (+227)": "+227",
    "NGA (+234)": "+234",
    "PRK (+850)": "+850",
    "NOR (+47)": "+47",
    "OMN (+968)": "+968",
    "PAK (+92)": "+92",
    "PLW (+680)": "+680",
    "PSE (+970)": "+970",
    "PAN (+507)": "+507",
    "PNG (+675)": "+675",
    "PRY (+595)": "+595",
    "PER (+51)": "+51",
    "PHL (+63)": "+63",
    "POL (+48)": "+48",
    "PRT (+351)": "+351",
    "PRI (+1-787)": "+1-787",
    "QAT (+974)": "+974",
    "ROU (+40)": "+40",
    "RUS (+7)": "+7",
    "RWA (+250)": "+250",
    "KNA (+1-869)": "+1-869",
    "LCA (+1-758)": "+1-758",
    "VCT (+1-784)": "+1-784",
    "WSM (+685)": "+685",
    "SMR (+378)": "+378",
    "SAU (+966)": "+966",
    "SEN (+221)": "+221",
    "SRB (+381)": "+381",
    "SYC (+248)": "+248",
    "SLE (+232)": "+232",
    "SGP (+65)": "+65",
    "SVK (+421)": "+421",
    "SVN (+386)": "+386",
    "SLB (+677)": "+677",
    "SOM (+252)": "+252",
    "ZAF (+27)": "+27",
    "KOR (+82)": "+82",
    "SSD (+211)": "+211",
    "ESP (+34)": "+34",
    "LKA (+94)": "+94",
    "SDN (+249)": "+249",
    "SUR (+597)": "+597",
    "SWZ (+268)": "+268",
    "SWE (+46)": "+46",
    "CHE (+41)": "+41",
    "SYR (+963)": "+963",
    "TWN (+886)": "+886",
    "TJK (+992)": "+992",
    "TZA (+255)": "+255",
    "THA (+66)": "+66",
    "TGO (+228)": "+228",
    "TON (+676)": "+676",
    "TTO (+1-868)": "+1-868",
    "TUN (+216)": "+216",
    "TUR (+90)": "+90",
    "TKM (+993)": "+993",
    "UGA (+256)": "+256",
    "UKR (+380)": "+380",
    "ARE (+971)": "+971",
    "GBR (+44)": "+44",
    "USA (+1)": "+1",
    "URY (+598)": "+598",
    "UZB (+998)": "+998",
    "VUT (+678)": "+678",
    "VAT (+379)": "+379",
    "VEN (+58)": "+58",
    "VNM (+84)": "+84",
    "YEM (+967)": "+967",
    "ZMB (+260)": "+260",
    "ZWE (+263)": "+263"
}

country_drop = ft.DropdownM2(
        label="Country",
        options = [ft.dropdownm2.Option(c) for c in country_prefixes.keys()],
        icon=ft.Icons.PHONE,
        value = "PHL (+63)",
        width=170,
    )



def email_domain(email_input, term, page):
    if "@" in term:
        email_input.suffix_text = None
    else:
        email_input.suffix_text = "@gmail.com"
    page.update()

def validate(name, phone, email, page):
    """
    Would validate name, phone, and email
    name: -> A string
    phone: -> A digit string, strictly integers
    email: -> A string consisting of a domain
    """
    if name.value.strip() == "":
        name.error_text = "Name cannot be empty!"
    else:
        name.error_text = None


    if phone.value.strip() == "":
        phone.error_text = "Phone cannot be empty!"
    elif not phone.value.lstrip('+').replace('-', '').isdigit():
        phone.error_text = "Phone must be a valid number!"
    else:
        phone.error_text = None


    if email.value.strip() == "":
        email.error_text = "Email cannot be empty!"
    elif "@" in email.value:
        if not bool(EMAIL_PATTERN.match(email.value.strip())):
            email.error_text = "Invalid email address"
    else:
        email.error_text = None

    if not email.error_text and not phone.error_text and not  name.error_text:
        return True
    else:
        return False


